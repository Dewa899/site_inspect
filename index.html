<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vibration Exposure Simulation A(8) - Decision Support Tool</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
<style>
  :root{
    --sp-1:8px; --sp-2:12px; --sp-3:16px; --sp-4:20px; --br:16px;
    --bg1:#f8fafc; --bg2:#f8fafc; --card:#ffffff;
    --ink:#0b1220; --muted:#4b5563; --line:#e5e7eb;
    --accent:#0369a1; --ok:#15803d; --warn:#ca8a04; --bad:#b91c1c;
    --focus: rgba(3,105,161,.25);
    --breakGreen:#bff2cf;
    --rr-ok:#d9fbe2; --rr-warn:#fff4c2; --rr-bad:#ffd6d6;
  }
  [data-theme="dark"]{
    --bg1:#0f172a; --bg2:#111827; --card:#0f162b;
    --ink:#e5e7eb; --muted:#b6c1d6; --line:#24324d;
    --accent:#7dd3fc; --ok:#86efac; --warn:#facc15; --bad:#fb7185;
    --focus: rgba(125,211,252,.45);
    --breakGreen:#bff2cf;
    --rr-ok:#163a23; --rr-warn:#3a2f13; --rr-bad:#3a1515;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:linear-gradient(180deg,var(--bg1),var(--bg2));line-height:1.5}
  header{padding:24px 16px 6px;text-align:center}
  header h1{margin:0 0 6px;font-weight:700;letter-spacing:.2px}
  header p{margin:0;color:var(--muted)}
  .brandbar{display:flex;justify-content:center;margin:8px 0 4px}
  .brandbar img{max-height:42px; width:auto; object-fit:contain}

  .wrap{max-width:1100px;margin:16px auto 42px;padding:0 16px}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:8px 0 16px}
  .btn{cursor:pointer;padding:10px 14px;border-radius:12px;border:1px solid color-mix(in oklab, var(--ink) 15%, transparent);background:color-mix(in oklab, var(--card) 92%, black 8%);color:var(--ink); min-height:44px}
  .btn:hover{border-color:var(--accent)}
  .btn:focus-visible{outline:none; box-shadow:0 0 0 3px var(--focus)}
  .btn.secondary{background:transparent}
  .btn.icon{display:inline-flex;align-items:center;gap:8px}
  .btn.small{padding:6px 10px; min-height:36px}

  .langbtns{display:flex;gap:8px;align-items:center}
  .langbtn{
    border:1px solid color-mix(in oklab, var(--ink) 15%, transparent);
    background:var(--card); border-radius:999px; padding:4px 8px;
    display:inline-flex; align-items:center; gap:8px; cursor:pointer; min-height:44px
  }
  .langbtn img{width:28px;height:20px;object-fit:cover;border-radius:3px}
  .langbtn.active{outline:2px solid var(--accent); outline-offset:2px}

  .card{background:linear-gradient(180deg,var(--card),color-mix(in oklab, var(--card) 90%, black 10%));border:1px solid color-mix(in oklab, var(--ink) 10%, transparent);border-radius:var(--br); padding:18px;box-shadow:0 8px 24px rgba(0,0,0,.12); margin-bottom:14px}
  .grid{display:grid;gap:14px}
  @media(min-width:980px){ .grid{grid-template-columns:1.05fr 1.15fr}}
  label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px}
  input[type=number]{width:100%;padding:10px 12px;background:var(--card);border:1px solid color-mix(in oklab, var(--ink) 18%, transparent);color:var(--ink);border-radius:12px;outline:none}
  input[type=number]:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--focus)}
  .row{display:grid;gap:12px;grid-template-columns:repeat(4,1fr)}
  @media(max-width:720px){ .row{grid-template-columns:1fr}}
  .hint{font-size:12px;color:var(--muted)}
  .stat{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:color-mix(in oklab, var(--card) 92%, black 8%);border:1px solid var(--line);border-radius:12px;margin:8px 0}
  .stat b{font-size:18px}
  .pill{padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line);color:var(--muted);background:transparent}
  .ok{color:var(--ok);border-color:color-mix(in oklab, var(--ok) 40%, transparent)}
  .warn{color:var(--warn);border-color:color-mix(in oklab, var(--warn) 40%, transparent)}
  .bad{color:var(--bad);border-color:color-mix(in oklab, var(--bad) 40%, transparent)}
  h2{margin:10px 0 8px}
  h3{margin:8px 0 6px}
  ul{margin:8px 0 0 18px}

  table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px;margin-top:8px}
  th,td{padding:10px 12px;text-align:left;border-bottom:1px solid var(--line)}
  th{font-weight:600;color:var(--muted);background:color-mix(in oklab, var(--card) 85%, black 15%);position:sticky;top:0}
  tr:last-child td{border-bottom:none}
  #schedTable tbody tr{cursor:pointer}
  #schedTable tbody tr:hover{background:color-mix(in oklab, var(--accent) 12%, transparent)}
  #schedTable tbody tr.active{outline:2px solid var(--accent); outline-offset:-2px}

  .small{font-size:12px;color:var(--muted)}
  .chartbox{position:relative;width:100%;height:clamp(260px,36vw,360px)}
  canvas{width:100%!important;height:100%!important;background:color-mix(in oklab, var(--card) 85%, black 15%);border-radius:12px;padding:8px}

  .controls-inline{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:.5rem 0}
  .vsep{width:1px;height:24px;background:var(--line);display:inline-block}
  .num-sm{max-width:90px}

  /* Ready-Reckoner (mobile-first) */
  .ready-wrap{overflow:auto;border:1px solid var(--line);border-radius:12px}
  .ready{
    border-collapse:separate;border-spacing:0;width:max-content;min-width:100%;
    font-size:clamp(9px,2.4vw,12px); /* font dinamis untuk ponsel */
  }
  .ready th, .ready td{padding:6px 8px;border-bottom:1px solid var(--line);border-right:1px solid var(--line);white-space:nowrap}
  .ready tr:last-child td{border-bottom:none}
  .ready th:first-child, .ready td:first-child{position:sticky;left:0;background:color-mix(in oklab, var(--card) 92%, black 8%);z-index:2}
  .ready thead th{position:sticky;top:0;z-index:3}
  .ready .pv-ok{background:var(--rr-ok)}
  .ready .pv-warn{background:var(--rr-warn)}
  .ready .pv-bad{background:var(--rr-bad)}
  .ready td.sel{outline:2px solid var(--accent); outline-offset:-2px}
  .ready caption{caption-side:top;text-align:left;font-weight:600;color:var(--muted);padding:8px 4px;font-size:clamp(10px,2.6vw,13px)}

  footer{max-width:1100px;margin:20px auto 60px;color:var(--muted);text-align:center;padding:0 16px}
  footer a{color:var(--accent);text-decoration:none}
  footer a:hover{text-decoration:underline}
  @media print{
    *{background:transparent !important;color:#000 !important;box-shadow:none !important;-webkit-print-color-adjust:exact;print-color-adjust:exact}
    body{background:#fff !important}
    header p, .hint{color:#000 !important}
    .card, .stat, table, th, td{background:#fff !important; color:#000 !important; border-color:#000 !important}
    .pill{border-color:#000 !important; color:#000 !important; background:transparent !important}
    .chartbox{height:auto !important}
    canvas{width:140mm !important;height:140mm !important;background:#fff !important;padding:0 !important;border-radius:0 !important}
    footer a{color:#000 !important}
  }
</style>
</head>
<body>
<header>
  <h1 id="t_title">Vibration Exposure Simulation A(8) (EU 2002/44/EC)</h1>
  <p id="t_sub">Formula: <span style="font-family:ui-monospace">A(8) = a‚Çï·µ• ¬∑ ‚àö(T / 8)</span>, T in hours; normalized to 8 h</p>
  <div class="brandbar">
    <img src="https://mokhamadabrar.github.io/site_inspect/tnt_logo.svg" alt="Turner & Townsend logo" />
  </div>
</header>

<div class="toolbar" role="group" aria-label="Toolbar">
  <button class="btn icon" id="btnPrint" title="Print/Save PDF">üñ®Ô∏è <span>Print PDF</span></button>
  <button class="btn icon secondary" id="btnTheme" title="Toggle theme">üåì <span id="themeLabel">Light</span></button>
  <button class="btn icon secondary" id="btnCopy" title="Copy configuration link">üîó <span>Copy Link</span></button>

  <span class="vsep" aria-hidden="true"></span>

  <div class="langbtns" role="group" aria-label="Language">
    <button class="langbtn" id="btnEN" aria-pressed="true" title="English">
      <img src="https://mokhamadabrar.github.io/site_inspect/EN.png" alt="EN flag"/>
      <span>EN</span>
    </button>
    <button class="langbtn" id="btnID" aria-pressed="false" title="Indonesia">
      <img src="https://mokhamadabrar.github.io/site_inspect/ID.png" alt="ID flag"/>
      <span>ID</span>
    </button>
  </div>
</div>

<div class="wrap">
  <div class="card grid">
    <div>
      <h2 id="t_inputs">Inputs</h2>
      <label for="ahv" id="t_ahvlabel">a‚Çï·µ• (m/s¬≤) ‚Äì tool RMS</label>
      <input id="ahv" type="number" step="0.01" min="0" value="2.50" />
      <div class="hint" id="t_ahvhint">Example: 2.50 m/s¬≤ (A(8) equals 2.5 if used for full 8 h)</div>

      <div class="row" style="margin-top:10px">
        <div>
          <label for="targetA" id="t_targetlabel">Target A(8) (m/s¬≤)</label>
          <input id="targetA" type="number" step="0.01" min="0" value="2.50" />
          <div class="hint" id="t_targethint">Recommended &lt;= 2.50 as a safety margin</div>
        </div>
        <div>
          <label for="shiftH" id="t_shiftlabel">Shift duration (h)</label>
          <input id="shiftH" type="number" step="0.5" min="1" value="8" />
          <div class="hint" id="t_shifthint">Exposure time ‚â§ shift; A(8) normalized to 8 h</div>
        </div>
        <div>
          <label for="toolHours" id="t_toolhlabel">Tool hours/day (total)</label>
          <input id="toolHours" type="number" step="0.25" min="0" value="8" />
          <div class="hint" id="t_toolhhint">For minimum operators (rotation)</div>
        </div>
        <div style="display:flex;align-items:end;gap:8px;flex-wrap:wrap">
          <button class="btn" id="btnCalc">Calculate</button>
          <button class="btn secondary" id="btnOptimize">Optimize Duty</button>
          <button class="btn secondary" id="btnResetSel" title="Reset selected duty">Reset Selection</button>
        </div>
      </div>

      <div class="stat" aria-live="polite">
        <span id="t_a8fulltxt">If used continuously for the whole shift, A(8) = <b id="a8full">‚Äî</b></span>
        <span class="pill" id="statusPill">‚Äî</span>
      </div>
      <div class="stat">
        <span id="t_tmax8txt">Max exposure for target (8-h basis): <b id="tmax8">‚Äî</b> h</span>
        <span class="pill ok" id="t_targetpill">Target-based</span>
      </div>
      <div class="stat">
        <span id="t_tmaxlimtxt">Exposure limited by shift: <b id="tmaxLimited">‚Äî</b> h</span>
        <span class="pill" id="t_shiftpill">Shift limit</span>
      </div>
      <div class="stat">
        <span id="t_perhourtxt">Per-hour recommendation: <b id="perHour">‚Äî</b> (work + break)</span>
        <span class="pill" id="t_dutypill">Duty cycle</span>
      </div>
      <div class="stat">
        <span id="t_opsneedtxt">Operators needed (min): <b id="opsNeeded">‚Äî</b></span>
        <span class="pill" id="t_rotpill">Rotation</span>
      </div>
      <div class="stat">
        <span>HSE exposure points: <b id="pointsNow">‚Äî</b></span>
        <span class="pill" id="pointsPill">‚Äî</span>
      </div>
    </div>

    <div>
      <h2 id="t_opts">Schedule Options & A(8)</h2>
      <div class="small" id="t_presethint">Add row: Work‚Ä≤ + Break‚Ä≤ per hour. <b>Click a row to update the donut chart & curve.</b></div>

      <div class="controls-inline" aria-label="Quick duty slider">
        <label class="small" for="quickWork" style="margin:0">Work per hour:</label>
        <input id="quickWork" type="range" min="0" max="60" step="5" value="45" aria-label="Work minutes per hour">
        <span id="quickBadge" class="pill">45‚Ä≤ work + 15‚Ä≤ break</span>
        <button class="btn secondary small" id="btnUseQuick">Use</button>
        <span class="vsep" aria-hidden="true"></span>
        <button class="btn small" id="btnAddPreset">+ Custom Preset</button>
      </div>

      <table id="schedTable" aria-label="Per-hour scheme table">
        <thead>
          <tr>
            <th id="t_colScheme">Per-hour scheme</th>
            <th>Duty</th>
            <th id="t_colT">T (h/day)</th>
            <th>A(8) (m/s¬≤)</th>
            <th id="t_colStatus">Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="small" style="margin-top:6px" id="t_dutydef">Duty = work minutes per hour / 60. Effective T = duty √ó shift (‚â§ shift). A(8)=a‚Çï·µ•¬∑‚àö(T/8).</div>
    </div>
  </div>

  <div class="card grid">
    <div>
      <h3 id="t_chart1title">Chart: Work vs Break per Hour</h3>
      <div class="chartbox"><canvas id="chartWB"></canvas></div>
    </div>
    <div>
      <h3 id="t_chart2title">Chart: Risk Analysis of A(8) vs Shift Duration</h3>
      <div class="chartbox"><canvas id="chartA8"></canvas></div>
      <div class="controls-inline">
        <label class="small" style="margin:0"><input type="checkbox" id="yManual"> Manual Y-axis</label>
        <label class="small">Min <input id="yMin" type="number" class="num-sm" step="0.1" value="0"></label>
        <label class="small">Max <input id="yMax" type="number" class="num-sm" step="0.1" value="6"></label>
        <button class="btn secondary small" id="btnApplyY">Apply</button>
      </div>
      <div class="small" id="t_chart2hint">Curves auto-generated from Calculated, Optimized (5-min step), and Selected duties.</div>
    </div>
  </div>

  <div class="card">
    <h2 id="rr_title">Ready-Reckoner: Vibration Exposure Points</h2>
    <p class="small" id="rr_desc">
      Points use the HSE scheme: <code>Points = 2 √ó a¬≤ √ó t</code> (a in m/s¬≤, t in hours). 100 pts ‚âà EAV (A(8)=2.5), 400 pts ‚âà ELV (A(8)=5).
      Click a cell to apply its <i>a</i> and <i>T</i> to the simulation.
    </p>
    <div class="ready-wrap">
      <table class="ready" id="rrTable" role="grid" aria-label="Ready-Reckoner table">
        <caption id="rrCap">Daily exposure duration ‚Üí</caption>
        <thead><tr id="rrHead"></tr></thead>
        <tbody id="rrBody"></tbody>
      </table>
    </div>
  </div>

  <div class="card" id="card-rotation">
    <h2 id="t_sec2">Worker Rotation</h2>
    <p id="t_sec2p">If the total workload exceeds the maximum exposure time per person, divide the work among several operators. Rotation is an effective administrative control. Minimum operators = ceil(Total Tool Hours / T<sub>max</sub>).</p>
  </div>
  <div class="card" id="card-engineering">
    <h2 id="t_sec3">Engineering Controls</h2>
    <ul id="t_sec3ul">
      <li><b>Top Priority:</b> Use low-vibration tools or anti-vibration handles.</li>
      <li>Regular maintenance: balancing, alignment, replace worn components causing vibration.</li>
    </ul>
  </div>
  <div class="card" id="card-administrative">
    <h2 id="t_sec4">Administrative Controls</h2>
    <ul id="t_sec4ul">
      <li>Implement work & break schedules to lower daily exposure (T).</li>
      <li>Schedule high-vibration tasks early in the shift.</li>
    </ul>
  </div>
  <div class="card" id="card-technique">
    <h2 id="t_sec5">Training & Work Technique</h2>
    <ul id="t_sec5ul">
      <li>Grip lightly (without losing control) to minimize transmission.</li>
      <li>Use good posture; avoid awkward positions.</li>
    </ul>
  </div>
  <div class="card" id="card-ppe">
    <h2 id="t_sec6">PPE</h2>
    <ul id="t_sec6ul">
      <li>Use certified anti-vibration gloves (EN ISO 10819). Limited effectiveness at low frequencies.</li>
      <li>PPE is not a substitute for engineering/administrative controls.</li>
    </ul>
  </div>
  <div class="card"><p class="small" id="t_foot">EU thresholds: EAV = 2.5 m/s¬≤; ELV = 5.0 m/s¬≤. Control hierarchy: Engineering &gt; Administrative &gt; PPE.</p></div>
</div>

<footer>
  <div><a href="https://id.linkedin.com/in/mokhamadabrar" target="_blank" rel="noopener">Desaigned by Mokhamad Abrar</a></div>
  <div><a href="https://id.linkedin.com/in/avior-qhse" target="_blank" rel="noopener">Revewed by Ratu Avior, MSc.</a> and <a href="https://id.linkedin.com/in/raniannisaroyani" target="_blank" rel="noopener">Ir. Rani Anisa Royani</a></div>
  <div>Sustainable Apps Development @ Aug 2025</div>
</footer>

<script src="script.js" defer></script>
</body>
</html>