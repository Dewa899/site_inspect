<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vibration Exposure Simulation A(8) - Decision Support Tool</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
<style>
  :root{
    --bg1:#0f172a; --bg2:#111827; --card:#111827; --ink:#e5e7eb; --muted:#b6c1d6;
    --accent:#7dd3fc; --ok:#86efac; --warn:#facc15; --bad:#fb7185; --br:16px;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--ink); background:linear-gradient(180deg,var(--bg1),var(--bg2))}
  header{padding:22px 16px 8px;text-align:center}
  header h1{margin:0 0 6px;font-weight:700;letter-spacing:.2px}
  header p{margin:0;color:var(--muted)}
  .wrap{max-width:1100px;margin:18px auto 40px;padding:0 16px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:8px 0 16px}
  .btn{cursor:pointer;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:#0e1530;color:var(--ink)}
  .btn:hover{border-color:var(--accent)}
  select{padding:10px;border-radius:10px;background:#0b1326;color:var(--ink);border:1px solid rgba(255,255,255,.18)}
  .card{background:linear-gradient(180deg,#121a2f,#0f162b); border:1px solid rgba(255,255,255,.06); border-radius:var(--br); padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.35); margin-bottom:14px; transition: border-color .3s, box-shadow .3s}
  .card.highlight-warn{border-color: rgba(250, 204, 21, 0.6); box-shadow: 0 0 15px rgba(250, 204, 21, 0.2)}
  .card.highlight-bad{border-color: rgba(251, 113, 133, 0.6); box-shadow: 0 0 15px rgba(251, 113, 133, 0.25)}
  .grid{display:grid;gap:14px}
  @media(min-width:980px){ .grid{grid-template-columns:1.08fr 1.12fr}}
  label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px}
  input[type=number]{width:100%;padding:10px 12px;background:#0b1326;border:1px solid rgba(255,255,255,.12);color:var(--ink);border-radius:10px;outline:none}
  input[type=number]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(125,211,252,.18)}
  .row{display:grid;gap:12px;grid-template-columns:repeat(4,1fr)}
  @media(max-width:720px){ .row{grid-template-columns:1fr}}
  .hint{font-size:12px;color:var(--muted)}
  .stat{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#0e1733;border:1px solid rgba(255,255,255,.08);border-radius:12px;margin:8px 0}
  .stat b{font-size:18px}
  .pill{padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.15);color:var(--muted)}
  .ok{color:var(--ok);border-color:rgba(134,239,172,.35)}
  .warn{color:var(--warn);border-color:rgba(250,204,21,.35)}
  .bad{color:var(--bad);border-color:rgba(251,113,133,.35)}
  h2{margin:10px 0 8px}
  h3{margin:8px 0 6px}
  ul{margin:8px 0 0 18px}
  table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px;margin-top:8px}
  th,td{padding:10px 12px;text-align:left;border-bottom:1px solid rgba(255,255,255,.08)}
  th{font-weight:600;color:var(--muted);background:#101a36;position:sticky;top:0}
  tr:last-child td{border-bottom:none}
  #schedTable tbody tr{cursor:pointer}
  #schedTable tbody tr:hover{background:rgba(125,211,252,0.08)}
  .small{font-size:12px;color:var(--muted)}
  .chartbox{position:relative;width:100%;height:clamp(240px,36vw,340px)}
  canvas{width:100%!important;height:100%!important;background:#0f1a36;border-radius:12px;padding:8px}
  footer{max-width:1100px;margin:20px auto 60px;color:var(--muted);text-align:center;padding:0 16px}
  footer a{color:var(--accent);text-decoration:none}
  footer a:hover{text-decoration:underline}
  @media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;-webkit-print-color-adjust:exact;print-color-adjust:exact}body{background:#fff !important}header p, .hint{color:#000 !important}.card, .stat, table, th, td{background:#fff !important; color:#000 !important; border-color:#000 !important}.pill{border-color:#000 !important; color:#000 !important; background:transparent !important}.chartbox{height:auto !important}canvas{width:140mm !important;height:140mm !important;background:#fff !important;padding:0 !important;border-radius:0 !important}footer a{color:#000 !important}}
</style>
</head>
<body>
<header>
  <h1 id="t_title">Simulasi Paparan Getaran A(8) (EU 2002/44/EC)</h1>
  <p id="t_sub">Rumus: <span style="font-family:ui-monospace">A(8) = a‚Çï·µ• ¬∑ ‚àö(T / 8)</span>, T dalam jam; normalisasi ke 8 jam</p>
</header>
<div class="toolbar">
  <button class="btn" id="btnPrint">üñ®Ô∏è Print PDF</button>
  <label class="small" for="langSel" id="t_langlabel">Bahasa:</label>
  <select id="langSel"><option value="id">Indonesia (ID)</option><option value="en">English (EN)</option></select>
</div>
<div class="wrap">
  <div class="card grid">
    <div>
      <h2 id="t_inputs">Input</h2>
      <label for="ahv" id="t_ahvlabel">a‚Çï·µ• (m/s¬≤) ‚Äì RMS alat</label>
      <input id="ahv" type="number" step="0.01" min="0" value="2.50" />
      <div class="hint" id="t_ahvhint">Contoh: 2.50 m/s¬≤ (A(8) = 2.5 jika 8 jam penuh)</div>
      <div class="row" style="margin-top:10px">
        <div><label for="targetA" id="t_targetlabel">Target A(8) (m/s¬≤)</label><input id="targetA" type="number" step="0.01" min="0" value="2.20" /><div class="hint" id="t_targethint">Disarankan &lt; 2.50 sebagai margin aman</div></div>
        <div><label for="shiftH" id="t_shiftlabel">Durasi shift (jam)</label><input id="shiftH" type="number" step="0.5" min="1" value="8" /><div class="hint" id="t_shifthint">Paparan ‚â§ durasi shift; A(8) tetap dinormalisasi 8 jam</div></div>
        <div><label for="toolHours" id="t_toolhlabel">Total jam alat/hari</label><input id="toolHours" type="number" step="0.25" min="0" value="8" /><div class="hint" id="t_toolhhint">Untuk hitung operator minimum (rotasi)</div></div>
        <div style="display:flex;align-items:end"><button class="btn" id="btnCalc">Hitung</button></div>
      </div>
      <div class="stat"><span id="t_a8fulltxt">Jika dipakai terus sepanjang shift, A(8) = <b id="a8full">‚Äî</b></span><span class="pill" id="statusPill">‚Äî</span></div>
      <div class="stat"><span id="t_tmax8txt">Durasi paparan maksimum (target, basis 8 jam): <b id="tmax8">‚Äî</b> jam</span><span class="pill ok" id="t_targetpill">Target-based</span></div>
      <div class="stat"><span id="t_tmaxlimtxt">Batas paparan dibatasi shift: <b id="tmaxLimited">‚Äî</b> jam</span><span class="pill" id="t_shiftpill">Shift limit</span></div>
      <div class="stat"><span id="t_perhourtxt">Rekomendasi per jam: <b id="perHour">‚Äî</b> (kerja + jeda)</span><span class="pill" id="t_dutypill">Duty cycle</span></div>
      <div class="stat"><span id="t_opsneedtxt">Kebutuhan operator (min): <b id="opsNeeded">‚Äî</b></span><span class="pill" id="t_rotpill">Rotasi</span></div>
    </div>
    <div>
      <h2 id="t_opts">Opsi Jadwal & A(8)</h2>
      <div class="small" id="t_presethint">Tambah baris: Work‚Ä≤ + Break‚Ä≤ per jam. <b>Klik baris untuk update chart donat.</b></div>
      <div style="margin:.5rem 0" class="flex"><button class="btn" id="btnAddPreset">+ Preset Kustom</button></div>
      <table id="schedTable"><thead><tr><th id="t_colScheme">Skema per jam</th><th>Duty</th><th id="t_colT">T (jam/hari)</th><th>A(8) (m/s¬≤)</th><th id="t_colStatus">Status</th><th></th></tr></thead><tbody></tbody></table>
      <div class="small" style="margin-top:6px" id="t_dutydef">Duty = menit kerja per jam / 60. T efektif = duty √ó durasi shift (‚â§ shift). A(8)=a‚Çï·µ•¬∑‚àö(T/8).</div>
    </div>
  </div>
  <div class="card grid">
    <div><h3 id="t_chart1title">Chart: Work vs Break per Jam</h3><div class="chartbox"><canvas id="chartWB"></canvas></div></div>
    <div><h3 id="t_chart2title">Chart: Analisis Risiko A(8) vs Durasi Shift</h3><div class="chartbox"><canvas id="chartA8"></canvas></div><div class="small" id="t_chart2hint">Kurva dihitung untuk duty aktif terpilih & a‚Çï·µ• saat ini</div></div>
  </div>
  <div class="card" id="card-rotation"><h2 id="t_sec2">Rotasi Pekerja (Work Rotation)</h2><p id="t_sec2p">Jika beban kerja total &gt; durasi paparan maksimum per orang, bagi pekerjaan ke beberapa operator. Rotasi adalah kontrol administratif yang sangat efektif untuk mengurangi paparan individu. Minimum operator = ceil(Total Jam Kerja Alat / T<sub>max</sub>).</p></div>
  <div class="card" id="card-engineering"><h2 id="t_sec3">Engineering Controls (Kontrol Rekayasa)</h2><ul id="t_sec3ul"><li><b>Prioritas Utama:</b> Gunakan model alat <i>low-vibration</i> atau pegangan anti-getaran.</li><li>Lakukan perawatan rutin: balancing, alignment, ganti komponen aus yang menjadi sumber getaran.</li></ul></div>
  <div class="card" id="card-administrative"><h2 id="t_sec4">Administrative Controls (Kontrol Administratif)</h2><ul id="t_sec4ul"><li>Terapkan jadwal kerja & jeda (vibration breaks) untuk menurunkan paparan harian (T).</li><li>Jadwalkan pekerjaan getaran tinggi di awal shift saat kondisi fisik pekerja masih optimal.</li></ul></div>
  <div class="card" id="card-technique"><h2 id="t_sec5">Pelatihan & Teknik Kerja</h2><ul id="t_sec5ul"><li>Genggam alat seringan mungkin (tanpa mengurangi kontrol) untuk meminimalkan transmisi getaran.</li><li>Gunakan postur kerja yang baik dan hindari posisi canggung yang meningkatkan beban pada tangan dan lengan.</li></ul></div>
  <div class="card" id="card-ppe"><h2 id="t_sec6">PPE (APD)</h2><ul id="t_sec6ul"><li>Gunakan sarung tangan anti-getaran bersertifikasi (EN ISO 10819). Efektivitasnya terbatas pada frekuensi tinggi.</li><li>APD bukanlah pengganti untuk kontrol rekayasa atau administratif.</li></ul></div>
  <div class="card"><p class="small" id="t_foot">Ambang EU: EAV = 2,5 m/s¬≤ (perlu tindakan); ELV = 5,0 m/s¬≤ (tidak boleh dilampaui). Hierarki kontrol: Rekayasa > Administratif > APD.</p></div>
</div>
<footer><div>Desaigned by Mokhamad Abrar</div><div>Revewed by Ratu Avior, MSc.</div><div>Sustainable Apps Development @ Aug 2025</div></footer>

<script>
// --- OBJEK TEKS LENGKAP (PENTING!) ---
const T = {
  id:{title:"Simulasi Paparan Getaran A(8) (EU 2002/44/EC)",sub:"Rumus: A(8) = a‚Çï·µ• ¬∑ ‚àö(T / 8), T dalam jam; normalisasi ke 8 jam",langlabel:"Bahasa:",inputs:"Input",ahvlabel:"a‚Çï·µ• (m/s¬≤) ‚Äì RMS alat",ahvhint:"Contoh: 2.50 m/s¬≤ (A(8) = 2.5 jika 8 jam penuh)",targetlabel:"Target A(8) (m/s¬≤)",targethint:"Disarankan < 2.50 sebagai margin aman",shiftlabel:"Durasi shift (jam)",shifthint:"Paparan ‚â§ durasi shift; A(8) tetap dinormalisasi 8 jam",toolhlabel:"Total jam alat/hari",toolhhint:"Untuk hitung operator minimum (rotasi)",a8fulltxt:"Jika dipakai terus sepanjang shift, A(8) = ",tmax8txt:"Durasi paparan maksimum (target, basis 8 jam): ",tmaxlimtxt:"Batas paparan dibatasi shift: ",perhourtxt:"Rekomendasi per jam: ",opsneedtxt:"Kebutuhan operator (min): ",opts:"Opsi Jadwal & A(8)",presethint:"Tambah baris: Work‚Ä≤ + Break‚Ä≤ per jam. <b>Klik baris untuk update chart donat.</b>",colScheme:"Skema per jam",colT:"T (jam/hari)",colStatus:"Status",dutydef:"Duty = menit kerja per jam / 60. T efektif = duty √ó durasi shift (‚â§ shift). A(8)=a‚Çï·µ•¬∑‚àö(T/8).",chart1title:"Chart: Work vs Break per Jam",chart2title:"Chart: Analisis Risiko A(8) vs Durasi Shift",chart2hint:"Kurva dihitung untuk duty aktif terpilih & a‚Çï·µ• saat ini",sec2:"Rotasi Pekerja (Work Rotation)",sec2p:"Jika beban kerja total > durasi paparan maksimum per orang, bagi pekerjaan ke beberapa operator. Rotasi adalah kontrol administratif yang sangat efektif untuk mengurangi paparan individu. Minimum operator = ceil(Total Jam Kerja Alat / T<sub>max</sub>).",sec3:"Engineering Controls (Kontrol Rekayasa)",sec3ul:["<b>Prioritas Utama:</b> Gunakan model alat <i>low-vibration</i> atau pegangan anti-getaran.","Lakukan perawatan rutin: balancing, alignment, ganti komponen aus yang menjadi sumber getaran."],sec4:"Administrative Controls (Kontrol Administratif)",sec4ul:["Terapkan jadwal kerja & jeda (vibration breaks) untuk menurunkan paparan harian (T).","Jadwalkan pekerjaan getaran tinggi di awal shift saat kondisi fisik pekerja masih optimal."],sec5:"Pelatihan & Teknik Kerja",sec5ul:["Genggam alat seringan mungkin (tanpa mengurangi kontrol) untuk meminimalkan transmisi getaran.","Gunakan postur kerja yang baik dan hindari posisi canggung yang meningkatkan beban pada tangan dan lengan."],sec6:"PPE (APD)",sec6ul:["Gunakan sarung tangan anti-getaran bersertifikasi (EN ISO 10819). Efektivitasnya terbatas pada frekuensi tinggi.","APD bukanlah pengganti untuk kontrol rekayasa atau administratif."],foot:"Ambang EU: EAV = 2,5 m/s¬≤ (perlu tindakan); ELV = 5,0 m/s¬≤ (tidak boleh dilampaui). Hierarki kontrol: Rekayasa > Administratif > APD.",pills:{below:"Di bawah EAV",at:"Tepat EAV",between:"Antara EAV‚ÄìELV",above:"Di atas ELV!",target:"Berbasis target",shift:"Batas shift",duty:"Duty cycle",rot:"Rotasi"}},
  en:{title:"Vibration Exposure Simulation A(8) (EU 2002/44/EC)",sub:"Formula: A(8) = a‚Çï·µ• ¬∑ ‚àö(T / 8), T in hours; normalized to 8 h",langlabel:"Language:",inputs:"Inputs",ahvlabel:"a‚Çï·µ• (m/s¬≤) ‚Äì tool RMS",ahvhint:"Example: 2.50 m/s¬≤ (A(8) equals 2.5 if used for full 8 h)",targetlabel:"Target A(8) (m/s¬≤)",targethint:"Recommended < 2.50 as a safety margin",shiftlabel:"Shift duration (h)",shifthint:"Exposure time ‚â§ shift; A(8) normalized to 8 h",toolhlabel:"Tool hours/day (total)",toolhhint:"For minimum operators (rotation)",a8fulltxt:"If used continuously for the whole shift, A(8) = ",tmax8txt:"Max exposure for target (8-h basis): ",tmaxlimtxt:"Exposure limited by shift: ",perhourtxt:"Per-hour recommendation: ",opsneedtxt:"Operators needed (min): ",opts:"Schedule Options & A(8)",presethint:"Add row: Work‚Ä≤ + Break‚Ä≤ per hour. <b>Click a row to update the donut chart.</b>",colScheme:"Per-hour scheme",colT:"T (h/day)",colStatus:"Status",dutydef:"Duty = work minutes per hour / 60. Effective T = duty √ó shift (‚â§ shift). A(8)=a‚Çï·µ•¬∑‚àö(T/8).",chart1title:"Chart: Work vs Break per Hour",chart2title:"Chart: Risk Analysis of A(8) vs Shift Duration",chart2hint:"Curve computed for current duty & a‚Çï·µ•",sec2:"Worker Rotation",sec2p:"If the total workload exceeds the maximum exposure time per person, divide the work among several operators. Rotation is a very effective administrative control to reduce individual exposure. Minimum operators = ceil(Total Tool Hours / T<sub>max</sub>).",sec3:"Engineering Controls",sec3ul:["<b>Top Priority:</b> Use low-vibration tool models or anti-vibration handles.","Perform regular maintenance: balancing, alignment, replace worn components that cause vibration."],sec4:"Administrative Controls",sec4ul:["Implement work & break schedules (vibration breaks) to lower daily exposure (T).","Schedule high-vibration tasks at the start of the shift when workers are physically optimal."],sec5:"Training & Work Technique",sec5ul:["Grip the tool as lightly as possible (without losing control) to minimize vibration transmission.","Use good posture and avoid awkward positions that increase strain on hands and arms."],sec6:"PPE",sec6ul:["Use certified anti-vibration gloves (EN ISO 10819). Their effectiveness is limited at low frequencies.","PPE is not a substitute for engineering or administrative controls."],foot:"EU thresholds: EAV = 2.5 m/s¬≤ (action required); ELV = 5.0 m/s¬≤ (must not be exceeded). Control hierarchy: Engineering > Administrative > PPE.",pills:{below:"Below EAV",at:"At EAV",between:"Between EAV‚ÄìELV",above:"Above ELV!",target:"Target-based",shift:"Shift limit",duty:"Duty cycle",rot:"Rotation"}}
};
let lang = 'id';

function setLang(newLang){
  lang=newLang; const L=T[lang]; if(!L) return;
  const set=(id,txt)=>{const el=document.getElementById(id);if(el){if(Array.isArray(txt)){el.innerHTML=txt.map(li=>`<li>${li}</li>`).join('')}else{el.innerHTML=txt}}};
  Object.keys(L).forEach(key => { if(key.startsWith('sec') && !key.endsWith('ul')) { set(`t_${key}`, L[key]) } });
  set('t_title',L.title); set('t_sub',L.sub); set('t_langlabel',L.langlabel); set('t_inputs',L.inputs); set('t_ahvlabel',L.ahvlabel); set('t_ahvhint',L.ahvhint);
  set('t_targetlabel',L.targetlabel); set('t_targethint',L.targethint); set('t_shiftlabel',L.shiftlabel); set('t_shifthint',L.shifthint);
  set('t_toolhlabel',L.toolhlabel); set('t_toolhhint',L.toolhhint); set('t_a8fulltxt',`${L.a8fulltxt}<b id="a8full">‚Äî</b>`);
  set('t_tmax8txt',`${L.tmax8txt}<b id="tmax8">‚Äî</b> ${lang==='id'?'jam':'h'}`); set('t_tmaxlimtxt',`${L.tmaxlimtxt}<b id="tmaxLimited">‚Äî</b> ${lang==='id'?'jam':'h'}`);
  set('t_perhourtxt',`${L.perhourtxt}<b id="perHour">‚Äî</b> (kerja + jeda)`); set('t_opsneedtxt',`${L.opsneedtxt}<b id="opsNeeded">‚Äî</b>`);
  set('t_opts',L.opts); set('t_presethint',L.presethint); set('t_colScheme',L.colScheme); set('t_colT',L.colT); set('t_colStatus',L.colStatus);
  set('t_dutydef',L.dutydef); set('t_chart1title',L.chart1title); set('t_chart2title',L.chart2title); set('t_chart2hint',L.chart2hint);
  set('t_sec3ul',L.sec3ul); set('t_sec4ul',L.sec4ul); set('t_sec5ul',L.sec5ul); set('t_sec6ul',L.sec6ul);
  set('t_foot',L.foot);
  recalc();
}
function pillText(a8){ const P=T[lang].pills; if(!isFinite(a8))return{text:"‚Äî",cls:"pill"}; if(a8<2.5)return{text:P.below,cls:"pill ok"}; if(Math.abs(a8-2.5)<1e-9)return{text:P.at,cls:"pill warn"}; if(a8>5.0)return{text:P.above,cls:"pill bad"}; return{text:P.between,cls:"pill warn"}}
function fmt(x,d=2){if(!isFinite(x))return"‚Äî";return Number(x).toFixed(d)}

const defaultPresets=[{work:60,break:0,labelID:"60‚Ä≤ kerja + 0‚Ä≤ jeda (kontinu)",labelEN:"60‚Ä≤ work + 0‚Ä≤ break (continuous)"},{work:50,break:10,labelID:"50‚Ä≤ kerja + 10‚Ä≤ jeda",labelEN:"50‚Ä≤ work + 10‚Ä≤ break"},{work:45,break:15,labelID:"45‚Ä≤ kerja + 15‚Ä≤ jeda",labelEN:"45‚Ä≤ work + 15‚Ä≤ break"},{work:30,break:30,labelID:"30‚Ä≤ kerja + 30‚Ä≤ jeda",labelEN:"30‚Ä≤ work + 30‚Ä≤ break"},{work:20,break:40,labelID:"20‚Ä≤ kerja + 40‚Ä≤ jeda",labelEN:"20‚Ä≤ work + 40‚Ä≤ break"}];
let customPresets=[];
let chartWB, chartA8;

const whiteBG={id:'whiteBG',beforeDraw:(chart,args,opts)=>{const{ctx,chartArea}=chart;if(!chartArea)return;ctx.save();ctx.fillStyle=opts?.color||'#ffffff';ctx.fillRect(chartArea.left,chartArea.top,chartArea.right-chartArea.left,chartArea.bottom-chartArea.top);ctx.restore()}};
function buildCharts(){
  const ctx1=document.getElementById('chartWB').getContext('2d');
  chartWB=new Chart(ctx1,{type:'doughnut',data:{labels:['Kerja','Jeda'],datasets:[{data:[50,10],backgroundColor:['rgba(125, 211, 252, 0.7)','rgba(229, 231, 235, 0.2)'],borderColor:['var(--accent)','rgba(255,255,255,0.1)'],borderWidth:1}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{color: 'var(--ink)'}},whiteBG:{}}}});
  const ctx2=document.getElementById('chartA8').getContext('2d');
  chartA8=new Chart(ctx2,{type:'line',data:{labels:[],datasets:[{label:'A(8)',data:[],tension:0.25,pointRadius:2,borderColor:'var(--accent)',backgroundColor:'rgba(125, 211, 252, 0.2)',fill:true}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},whiteBG:{},annotation:{annotations:{eav:{type:'box',yMin:2.5,yMax:5.0,backgroundColor:'rgba(250, 204, 21, 0.15)',borderColor:'rgba(250, 204, 21, 0.3)',borderWidth:1},elv:{type:'box',yMin:5.0,backgroundColor:'rgba(251, 113, 133, 0.15)',borderColor:'rgba(251, 113, 133, 0.3)',borderWidth:1},eavLine:{type:'line',yMin:2.5,yMax:2.5,borderColor:'var(--warn)',borderWidth:1.5,borderDash:[6,6],label:{content:'EAV: Action Level (2.5)',position:'start',enabled:true,font:{size:10},color:'var(--warn)',backgroundColor:'rgba(0,0,0,0.6)'}},elvLine:{type:'line',yMin:5.0,yMax:5.0,borderColor:'var(--bad)',borderWidth:1.5,label:{content:'ELV: Limit Value (5.0)',position:'start',enabled:true,font:{size:10},color:'var(--bad)',backgroundColor:'rgba(0,0,0,0.6)'}}}}},scales:{x:{title:{display:true,text:'Durasi Shift (jam)',color:'var(--muted)'},ticks:{color:'var(--muted)'}},y:{title:{display:true,text:'A(8) (m/s¬≤)',color:'var(--muted)'},min:0,ticks:{color:'var(--muted)'}}}},plugins:[whiteBG]});
}

function updateContextualHighlights(a8){
  const cards={eng:document.getElementById('card-engineering'),rot:document.getElementById('card-rotation'),admin:document.getElementById('card-administrative'),tech:document.getElementById('card-technique')};
  Object.values(cards).forEach(card=>card.classList.remove('highlight-warn','highlight-bad'));
  if(a8>5.0){cards.eng.classList.add('highlight-bad');cards.rot.classList.add('highlight-bad')}
  else if(a8>=2.5){cards.admin.classList.add('highlight-warn');cards.tech.classList.add('highlight-warn')}
}
function recalc(){
  const ahv=parseFloat(document.getElementById('ahv').value),targetA=parseFloat(document.getElementById('targetA').value)||2.2,shiftH=parseFloat(document.getElementById('shiftH').value),toolHours=parseFloat(document.getElementById('toolHours').value);
  const a8full=ahv*Math.sqrt(shiftH/8),pill=pillText(a8full);
  document.getElementById('a8full').textContent=fmt(a8full,2);
  const pillEl=document.getElementById('statusPill');pillEl.textContent=pill.text;pillEl.className=pill.cls;
  const Tmax8=8*Math.pow(targetA/ahv,2),TmaxLimited=Math.min(Tmax8,shiftH);
  document.getElementById('tmax8').textContent=fmt(Tmax8,2);document.getElementById('tmaxLimited').textContent=fmt(TmaxLimited,2);
  const duty=(shiftH>0)?(TmaxLimited/shiftH):0,workMin=Math.round(60*duty),breakMin=60-workMin;
  document.getElementById('perHour').textContent=`${workMin}‚Ä≤ + ${breakMin}‚Ä≤`;
  let opsNeeded="‚Äî";if(isFinite(toolHours)&&toolHours>0&&TmaxLimited>0)opsNeeded=Math.ceil(toolHours/TmaxLimited);document.getElementById('opsNeeded').textContent=opsNeeded;
  const rows=[...defaultPresets,...customPresets],tbody=document.querySelector('#schedTable tbody');tbody.innerHTML="";
  rows.forEach((p,idx)=>{const dutyRow=p.work/60,T=dutyRow*shiftH,A8=ahv*Math.sqrt(T/8),st=pillText(A8),label=(lang==='id'?(p.labelID||`${p.work}‚Ä≤+${p.break}‚Ä≤`):(p.labelEN||`${p.work}‚Ä≤+${p.break}‚Ä≤`)),tr=document.createElement('tr');tr.dataset.work=p.work;tr.dataset.break=p.break;tr.innerHTML=`<td>${label}</td><td>${Math.round(dutyRow*100)}%</td><td>${fmt(T,2)}</td><td>${fmt(A8,2)}</td><td><span class="${st.cls}">${st.text}</span></td><td>${idx>=defaultPresets.length?`<button class="btn btn-del" data-idx="${idx}">üóë</button>`:''}</td>`;tbody.appendChild(tr)});
  if(!chartWB.updatedFromTable){chartWB.data.datasets[0].data=[workMin,breakMin];chartWB.update()}chartWB.updatedFromTable=false;
  const xs=[],ys=[];for(let sh=1;sh<=12;sh+=0.5){const T=duty*sh,a8=ahv*Math.sqrt(T/8);xs.push(sh.toFixed(1));ys.push(+a8.toFixed(3))}chartA8.data.labels=xs;chartA8.data.datasets[0].data=ys;chartA8.update();updateContextualHighlights(a8full);
}
function addPreset(){
  const w=prompt(lang==='id'?'Menit kerja per jam (0‚Äì60)':'Work minutes per hour (0‚Äì60)','45'),b=prompt(lang==='id'?'Menit jeda per jam (0‚Äì60)':'Break minutes per hour (0‚Äì60)','15');
  if(w===null||b===null)return; const wi=Math.max(0,Math.min(60,parseFloat(w)||0)),bi=Math.max(0,Math.min(60,parseFloat(b)||0));
  if(wi+bi===0){alert(lang==='id'?'Tidak valid':'Invalid');return}customPresets.push({work:wi,break:bi});recalc();
}
document.addEventListener('click',e=>{if(e.target.classList.contains('btn-del')){const idx=parseInt(e.target.getAttribute('data-idx'),10),customIdx=idx-defaultPresets.length;if(customIdx>=0&&customIdx<customPresets.length){customPresets.splice(customIdx,1);recalc()}}});
document.querySelector('#schedTable tbody').addEventListener('click',e=>{const row=e.target.closest('tr');if(!row)return;const work=parseFloat(row.dataset.work),breakVal=parseFloat(row.dataset.break);if(!isNaN(work)&&!isNaN(breakVal)){chartWB.data.datasets[0].data=[work,breakVal];chartWB.updatedFromTable=true;chartWB.update()}});
document.getElementById('btnPrint').addEventListener('click',()=>window.print());
document.getElementById('btnCalc').addEventListener('click',recalc);
document.getElementById('btnAddPreset').addEventListener('click',addPreset);
document.getElementById('langSel').addEventListener('change',e=>setLang(e.target.value));
['ahv','targetA','shiftH','toolHours'].forEach(id=>document.getElementById(id).addEventListener('input',recalc));
document.addEventListener('DOMContentLoaded',()=>{buildCharts();setLang('id')});
</script>
</body>
</html>
